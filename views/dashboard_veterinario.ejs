<h1>Bienvenido, Dr. <%= user.nombre %></h1>

<div class="dashboard-container">
  <!-- SecciÃ³n de Citas -->
  <div class="appointments-section">
    <h1>Citas Programadas</h1>

<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Cliente</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <% citas.forEach(cita => { %>
      <tr>
        <td><%= cita.fecha?.toLocaleString() %></td>
        <td><%= cita.cliente_nombre %></td>
        <td class="actions-column">
          <% if (cita.estado === 'Pendiente') { %>
            <button 
              onclick="confirmarCita('<%= cita.id %>')" 
              class="btn-confirm">
              Confirmar Cita
            </button>
          <% } %>
          <a href="/chat/veterinario/<%= cita.cliente_id %>" class="btn-chat">
            Chatear con cliente
          </a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<style>
  .actions-column {
    display: flex;
    gap: 10px;
  }

  .btn-confirm {
    background: #28a745;
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
  }

  .btn-confirm:hover {
    background: #218838;
  }

  .btn-chat {
    background: #007bff;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    text-decoration: none;
  }

  .btn-chat:hover {
    background: #0056b3;
  }
</style>

<script>
function confirmarCita(citaId) {
  fetch(`/citas/confirmar/${citaId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Hide the confirm button and show success message
      alert('Cita confirmada exitosamente');
      // Reload the page to reflect the changes
      window.location.reload();
    } else {
      alert('Error al confirmar la cita');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error al confirmar la cita');
  });
}
</script>